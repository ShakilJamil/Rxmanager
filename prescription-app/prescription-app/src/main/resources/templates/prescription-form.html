<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Prescription Form</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
<div class="container mx-auto p-4">
    <h2 class="text-2xl mb-4" th:text="${prescription.id} ? 'Edit Prescription' : 'New Prescription'"></h2>
    <form th:action="@{/prescriptions}" th:object="${prescription}" method="post" onsubmit="return validateForm()">
        <input type="hidden" id="id" name="id" th:field="*{id}" autocomplete="off"/>
        <div class="mb-4">
            <label for="prescriptionDate" class="block text-sm font-medium text-gray-700">Prescription Date</label>
            <input type="date" id="prescriptionDate" name="prescriptionDate" th:field="*{prescriptionDate}" autocomplete="off" class="mt-1 p-2 border w-full rounded"/>
        </div>
        <div class="mb-4">
            <label for="patientName" class="block text-sm font-medium text-gray-700">Patient Name</label>
            <input type="text" id="patientName" name="patientName" th:field="*{patientName}" autocomplete="name" class="mt-1 p-2 border w-full rounded"/>
        </div>
        <div class="mb-4">
            <label for="patientAge" class="block text-sm font-medium text-gray-700">Patient Age</label>
            <input type="number" id="patientAge" name="patientAge" th:field="*{patientAge}" autocomplete="off" class="mt-1 p-2 border w-full rounded"/>
        </div>
        <div class="mb-4">
            <label for="patientGender" class="block text-sm font-medium text-gray-700">Patient Gender</label>
            <select id="patientGender" name="patientGender" th:field="*{patientGender}" autocomplete="sex" class="mt-1 p-2 border w-full rounded">
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
        </div>
        <div class="mb-4">
            <label for="diagnosis" class="block text-sm font-medium text-gray-700">Diagnosis</label>
            <input type="text" id="diagnosis" name="diagnosis" th:field="*{diagnosis}" autocomplete="off" class="mt-1 p-2 border w-full rounded"/>
        </div>
        <div class="mb-4">
            <label for="medicines" class="block text-sm font-medium text-gray-700">Medicines</label>
            <input type="text" id="medicines" name="medicines" th:field="*{medicines}" autocomplete="off" class="mt-1 p-2 border w-full rounded"/>
        </div>
        <div class="mb-4">
            <label for="nextVisitDate" class="block text-sm font-medium text-gray-700">Next Visit Date</label>
            <input type="date" id="nextVisitDate" name="nextVisitDate" th:field="*{nextVisitDate}" autocomplete="off" class="mt-1 p-2 border w-full rounded"/>
        </div>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Save</button>
        <a href="/prescriptions" class="bg-gray-500 text-white px-4 py-2 rounded ml-2">Cancel</a>
    </form>
</div>
<script>
    function validateForm() {
        const ageInput = document.querySelector('#patientAge');
        const genderInput = document.querySelector('#patientGender');
        const dateInput = document.querySelector('#prescriptionDate');
        const nameInput = document.querySelector('#patientName');
        let isValid = true;

        document.querySelectorAll('.error').forEach(e => e.remove());

        if (!dateInput.value) {
            showError(dateInput, 'Prescription date is required');
            isValid = false;
        }

        if (!nameInput.value.trim()) {
            showError(nameInput, 'Patient name is required');
            isValid = false;
        }

        const age = parseInt(ageInput.value);
        if (isNaN(age) || age < 0 || age > 150) {
            showError(ageInput, 'Age must be between 0 and 150');
            isValid = false;
        }

        if (!genderInput.value) {
            showError(genderInput, 'Please select a gender');
            isValid = false;
        }

        return isValid;
    }

    function showError(input, message) {
        const error = document.createElement('span');
        error.className = 'error text-red-500 text-sm';
        error.textContent = message;
        input.parentElement.appendChild(error);
    }
</script>
</body>
</html>